function updateTime(){const e=new Date,t=e.toLocaleTimeString();document.getElementById("currentTime").textContent=t}setInterval(updateTime,1e3),updateTime();let db;const request=indexedDB.open("NotesDB",1);request.onupgradeneeded=function(e){db=e.target.result,db.objectStoreNames.contains("notes")||db.createObjectStore("notes",{keyPath:"id"})},request.onsuccess=function(e){db=e.target.result,console.log("IndexedDB initialized")},request.onerror=function(e){console.error("Error opening IndexedDB:",e.target.error)};const params=new URLSearchParams(window.location.search),monthIndex=parseInt(params.get("month"),10),year=parseInt(params.get("year"),10),startDay=parseInt(params.get("startDay"),10),months=[{name:"January",days:31},{name:"February",days:28},{name:"March",days:31},{name:"April",days:30},{name:"May",days:31},{name:"June",days:30},{name:"July",days:31},{name:"August",days:31},{name:"September",days:30},{name:"October",days:31},{name:"November",days:30},{name:"December",days:31}];(year%4==0&&year%100!=0||year%400==0)&&(months[1].days=29);const month=months[monthIndex],monthContainer=document.getElementById("month-container"),monthBox=document.createElement("div");monthBox.className="month-box large";const monthHeader=document.createElement("div");monthHeader.className="month-header",monthHeader.textContent=month.name;const weekDays=document.createElement("div");weekDays.className="week-days",["Su","Mo","Tu","We","Th","Fr","Sa"].forEach((e=>{const t=document.createElement("div");t.textContent=e,weekDays.appendChild(t)}));const daysContainer=document.createElement("div");daysContainer.className="days";let currentStartDay=startDay;for(let e=0;e<monthIndex;e++)currentStartDay=(currentStartDay+months[e].days)%7;for(let e=0;e<currentStartDay;e++){const t=document.createElement("div");t.className="empty",daysContainer.appendChild(t)}for(let e=1;e<=month.days;e++){const t=document.createElement("div");t.textContent=e;const n=(currentStartDay+e-1)%7;0===n&&(t.style.color="red"),t.addEventListener("click",(()=>openNoteModal(monthIndex,e,year))),daysContainer.appendChild(t)}function openNoteModal(e,t,n){const o=document.getElementById("note-modal"),a=document.getElementById("note-text"),c=document.getElementById("save-note-button"),d=document.querySelectorAll(".icon"),s=`year-${n}-month-${e+1}-day-${t}`;fetchNoteFromDB(s,(e=>{e=e||{text:"",icons:[]},a.value=e.text,d.forEach((t=>{e.icons.includes(t.dataset.icon)?t.classList.add("selected"):t.classList.remove("selected")})),o.style.display="flex";let n=[...e.icons];d.forEach((e=>{e.onclick=()=>{const t=e.dataset.icon;n.includes(t)?(n=n.filter((e=>e!==t)),e.classList.remove("selected")):(n.push(t),e.classList.add("selected"))}})),c.onclick=()=>{saveNoteToDB({id:s,text:a.value,icons:n}),o.style.display="none"}}))}function closeNoteModal(){document.getElementById("note-modal").style.display="none"}monthBox.appendChild(monthHeader),monthBox.appendChild(weekDays),monthBox.appendChild(daysContainer),monthContainer.appendChild(monthBox),document.querySelector(".close-button").addEventListener("click",closeNoteModal),window.onclick=function(e){const t=document.getElementById("note-modal");e.target===t&&(t.style.display="none")};function fetchNoteFromDB(e,t){const n=db.transaction(["notes"],"readonly").objectStore("notes").get(e);n.onsuccess=function(){t(n.result)},n.onerror=function(e){console.error("Error fetching note:",e.target.error)}}function saveNoteToDB(e){const t=db.transaction(["notes"],"readwrite").objectStore("notes").put(e);t.onsuccess=function(){console.log("Note saved successfully:",e)},t.onerror=function(e){console.error("Error saving note:",e.target.error)}}document.getElementById("export-button").addEventListener("click",exportIndexedDBToCSV);function exportIndexedDBToCSV(){const e=db.transaction(["notes"],"readonly").objectStore("notes").getAll();e.onsuccess=function(){const t=e.result;if(!t.length)return console.log("No data to export."),void alert("No data to export.");let n="ID,Text,Icons\n";t.forEach((e=>{const t=e.icons.join(" | ");n+=`${e.id},"${e.text.replace(/"/g,'""')}",${t}\n`}));const o=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(o),c=document.createElement("a");c.href=a,c.download="NotesData.csv",c.click(),console.log("Data exported successfully.")},e.onerror=function(e){console.error("Error exporting data:",e.target.error)}}function goBack(){window.history.back()}
